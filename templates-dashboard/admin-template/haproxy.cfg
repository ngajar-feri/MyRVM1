global
    daemon
    log stdout local0
    chroot /var/lib/haproxy
    stats timeout 30s
    user haproxy
    group haproxy

    # Default SSL material locations
    ca-base /etc/ssl/certs
    crt-base /etc/ssl/private

    # Intermediate configuration
    ssl-default-bind-ciphers ECDHE+AESGCM:ECDHE+CHACHA20:RSA+AESGCM:RSA+AES:!aNULL:!MD5:!DSS
    ssl-default-bind-options ssl-min-ver TLSv1.2 no-tls-tickets

defaults
    mode http
    log global
    option httplog
    option dontlognull
    option log-health-checks
    option forwardfor
    option http-server-close
    timeout connect 5000
    timeout client 50000
    timeout server 50000

# Frontend configuration
frontend vuexy_frontend
    bind *:80
    mode http
    
    # Security headers
    http-response set-header X-Frame-Options SAMEORIGIN
    http-response set-header X-Content-Type-Options nosniff
    http-response set-header X-XSS-Protection "1; mode=block"
    
    # Compression
    compression algo gzip
    compression type text/html text/plain text/css text/javascript application/javascript application/json
    
    # Default backend
    default_backend vuexy_backend

# Backend configuration
backend vuexy_backend
    mode http
    balance roundrobin
    
    # Health check
    option httpchk GET /health
    http-check expect status 200
    
    # Server instances
    server vuexy-app-1 vuexy-app-1:80 check inter 30s rise 2 fall 3
    server vuexy-app-2 vuexy-app-2:80 check inter 30s rise 2 fall 3
    server vuexy-app-3 vuexy-app-3:80 check inter 30s rise 2 fall 3

# Statistics page
listen stats
    bind *:8080
    mode http
    stats enable
    stats uri /stats
    stats refresh 30s
    stats admin if TRUE
    stats auth admin:admin123
    
    # Stats page styling
    stats show-legends
    stats show-node
    stats show-desc "Vuexy Admin Template Load Balancer"
