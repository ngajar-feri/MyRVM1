Menjadi tiga bagian: **1. Project Overview (Hasil perapihan catatan)**, **2. Cross-Check Konsep (Diskusi Perbedaan)**, dan **3. Dokumentasi Teknis Mapping Role (File Markdown)**.

---

### BAGIAN 1: PROJECT OVERVIEW (Terstruktur)

Berikut adalah strukturisasi dari catatan Anda menjadi gambaran proyek yang menyeluruh.

#### **Nama Proyek: MyRVM Ecosystem (v1.0)**
Sebuah ekosistem daur ulang cerdas terdesentralisasi yang mengintegrasikan perangkat keras (_edge_), komputasi awan (_server_), dan kecerdasan buatan (_AI_) untuk mengotomatisasi pengumpulan botol plastik dan pemberian reward.

#### **Arsitektur Utama (4 Pilar)**

**1. RVM-Server (Backend Foundation)**
*   **Peran:** Pusat data dan logika bisnis (Desentralisasi).
*   **Teknologi:** Dockerized Stack (Laravel, PostgreSQL, Redis, Nginx, MinIO).
*   **Fitur Utama:**
    *   **User/Tenant Management:** Mengelola data pengguna dan mitra penukar poin.
    *   **API Management:** Gerbang utama untuk seluruh komunikasi antar komponen.
    *   **Transaction Logic:** Menerima data hasil deteksi dari *Edge*, memvalidasi, dan mengkalkulasi reward poin secara real-time.
    *   **Device Management:** Monitoring status RVM-Edge (Online/Offline, Penuh/Kosong).

**2. RVM-Edge (Smart Reverse Vending Machine)**
*   **Peran:** Titik interaksi fisik dan pemrosesan AI lokal.
*   **Perangkat:** NVIDIA Jetson Orin Nano (Main Unit) + ESP32 (Microcontroller).
*   **Fitur Utama:**
    *   **Local Computing (Edge AI):** Menjalankan model YOLO + SAM secara lokal untuk deteksi dan validasi botol instan.
    *   **Hardware Control:** Mengontrol pintu (door), motor conveyor/sorter, indikator LED, dan kamera.
    *   **User Interface:** Layar LCD Touchscreen untuk interaksi pengguna dan menampilkan QR Code Sesi.
    *   **Sensorik:** Mengirim data volume (ultrasonik) dan status operasional ke Server.

**3. RVM-CV (Computer Vision & Training Node)**
*   **Peran:** Unit komputasi performa tinggi (GPU Accelerated) untuk _support_ dan _training_.
*   **Infrastruktur:** VM102 (Local GPU Server) - *Stateless / No Storage* (Data diambil dari MinIO Server).
*   **Fitur Utama:**
    *   **Model Training:** Melatih ulang model (YOLO/SAM) menggunakan data baru.
    *   **Model Distribution:** Menyediakan endpoint untuk RVM-Edge mengunduh model terbaru (`best.pt`).
    *   **Audit/Fallback:** Melakukan verifikasi sekunder pada gambar jika RVM-Edge menandai transaksi sebagai mencurigakan (_fraud_) atau mengalami kegagalan sistem.

**4. RVM-Users (Mobile Apps)**
*   **Peran:** Antarmuka pengguna dan tenant.
*   **Pengguna:** End-user (penyetor botol) dan Tenant (penukar voucher).
*   **Fitur Utama:** Login, Scan QR RVM, Cek Poin/Saldo, Tukar Voucher.

---

### BAGIAN 2: CROSS-CHECK KONSEP & DISKUSI

Saya menemukan beberapa poin yang perlu kita selaraskan persepsinya agar tidak terjadi kebingungan saat implementasi:

1.  **Versi MyRVM (v1.0 vs v2.1)**
    *   *Catatan Anda:* Menyebutkan "**MyRVM v1.0**".
    *   *Diskusi Sebelumnya:* Kita sedang membahas roadmap menuju "**MyRVM v2.1**" (dengan fitur multi-tenant, Laravel 12, dll).
    *   *Saran:* Apakah kita sepakat untuk mereset penamaan versi menjadi **v1.0** untuk *fase produksi* ini (yang secara fitur sudah mencakup teknologi v2.1 yang kita bahas sebelumnya)? Atau ini adalah versi MVP?
    *   *Asumsi Saya:* Saya akan menganggap fitur-fitur canggih (Edge AI, Multi-tenant) tetap ada, hanya penamaan versinya saja yang Anda reset menjadi 1.0.

2.  **Alur Login di RVM (QR Code)**
    *   *Catatan Anda:* "...setelah user Login menggunakan QR Code..."
    *   *Cross-Check:* Di diskusi terakhir (Revisi 2.1), kita sepakat mengubah alur menjadi: **RVM Menampilkan QR -> User Scan pakai HP**.
    *   *Alasan:* Ini menghilangkan kebutuhan kamera QR khusus di RVM dan mengurangi kegagalan scan akibat cahaya/layar HP retak.
    *   *Konfirmasi:* Apakah kita tetap menggunakan metode **User Scan RVM**? (Di dokumen teknis di bawah, saya akan menggunakan asumsi ini karena lebih efisien).

3.  **RVM-CV (No Storage)**
    *   *Catatan Anda:* "Pure GPU computing (NO STORAGE)".
    *   *Implikasi:* Ini berarti saat melakukan Training, RVM-CV harus mengunduh dataset dari RVM-Server (MinIO) ke memory/temp disk, melatihnya, mengupload hasil `best.pt` kembali ke RVM-Server, lalu menghapus data lokalnya.
    *   *Konfirmasi:* Ini adalah desain *stateless* yang sangat bagus untuk skalabilitas. Saya akan mematuhinya.

---

### BAGIAN 3: DOKUMENTASI TEKNIS MAPPING KREDENSIAL-ROLES

Berikut adalah dokumen Markdown yang Anda minta.

---

**Nama File:** [`user-role-mapping-Kamis-08012026-2152.md`](user-role-mapping-Kamis-08012026-2152.md)

```markdown
# Dokumentasi Teknis: Mapping Kredensial & Role (MyRVM Ecosystem)

**Versi Dokumen:** [1.0](user-role-mapping-Kamis-08012026-2152.md)
**Tanggal Revisi:** Kamis, 08 Januari 2026 - 09:52 PM
**Tujuan:** Mendefinisikan matriks akses, peran pengguna (human), dan peran sistem (machine) dalam ekosistem MyRVM untuk memastikan keamanan dan isolasi data yang tepat.

## 1. Definisi Entitas & Aktor

Dalam ekosistem MyRVM, terdapat dua jenis aktor yang memerlukan autentikasi dan otorisasi:

1.  **Human Actors (Pengguna Manusia):** Berinteraksi melalui Dashboard Web atau Aplikasi Mobile.
2.  **System Actors (Mesin/Perangkat):** Berinteraksi melalui API Token (Sanctum) atau Client Credentials.

## 2. Matriks Peran (Roles)

### A. Human Roles (Tabel `roles`)

| Role | Kode Slug | Deskripsi & Cakupan Akses |
| :--- | :--- | :--- |
| **Super Admin** | `super-admin` | **Akses Penuh (Global).** Mengelola Tenant, Admin, Konfigurasi Sistem Global, Manajemen API Key Mesin, dan Monitoring RVM-CV. |
| **Admin** | `admin` | **Akses Terbatas (Tenant Level).** Mengelola RVM di wilayah/tenant-nya, Manajemen User (User Support), dan Laporan Transaksi Tenant. |
| **Tenant** | `tenant` | **Akses Mitra.** Mengelola stok Voucher, Validasi penukaran poin user, dan melihat laporan klaim voucher. |
| **User** | `user` | **Pengguna Akhir.** Melakukan transaksi deposit botol, melihat saldo poin, dan menukarkan poin dengan voucher via Aplikasi Mobile. |

### B. System Roles (Token Abilities / Scopes)

Mesin tidak login menggunakan email/password, melainkan menggunakan API Key atau Token yang di-generate dengan *capabilities* tertentu.

| System Actor | Tipe Kredensial | Scope / Capabilities |
| :--- | :--- | :--- |
| **RVM-Edge** | API Key (Per Device) | `rvm:init-session` (Meminta QR Sesi), `rvm:submit-transaction` (Kirim hasil deteksi), `rvm:log-status` (Kirim heartbeat/sensor data). |
| **RVM-CV** | Service Token | `cv:fetch-dataset` (Ambil gambar fraud), `cv:upload-model` (Update best.pt), `cv:read-job` (Cek antrian training). |

## 3. Mapping Kredensial & Autentikasi

### 3.1. Alur Autentikasi Manusia
*   **Metode:** OAuth2 (Google, Line, Discord) & Email/Password.
*   **Penyimpanan:** Tabel `users` dengan kolom `role_id`.
*   **Verifikasi:**
    *   Login Email: Wajib Verifikasi Email (`MustVerifyEmail`).
    *   Login Sosmed: Auto-verified (mengikuti status akun sosmed).

### 3.2. Alur Autentikasi RVM-Edge (Mesin)
*   **Metode:** `X-RVM-API-KEY` Header.
*   **Mapping:** Setiap unit fisik Jetson Orin Nano memiliki satu record di tabel `reverse_vending_machines`.
*   **Kredensial:**
    *   `device_id`: UUID unik mesin.
    *   `api_key`: String acak 64-karakter (disimpan terenkripsi/hashed di DB).
*   **Mekanisme:** Saat booting, RVM-Edge melakukan *handshake* ke RVM-Server. Jika valid, Server memberikan Temporary Access Token untuk sesi WebSocket.

### 3.3. Alur Autentikasi RVM-CV (Training Server)
*   **Metode:** Bearer Token (Sanctum).
*   **Mapping:** Dianggap sebagai `Special User` atau `Service Account` di backend.
*   **Mekanisme:** VM102 menggunakan token statis (yang dirotasi berkala) untuk berkomunikasi dengan endpoint khusus CV di RVM-Server.

## 4. Permission Matrix (Detail Izin)

| Fitur / Modul | Super Admin | Admin | Tenant | User | RVM-Edge | RVM-CV |
| :--- | :---: | :---: | :---: | :---: | :---: | :---: |
| **User Mgmt** | Full | View/Edit (Scoped) | - | Self (Profile) | - | - |
| **Tenant Mgmt** | Full | - | Self (Profile) | - | - | - |
| **RVM Mgmt** | Full (Create/Delete) | Monitor/Reboot | - | - | Self (Status) | - |
| **Transactions** | View All | View (Scoped) | View (Redeem only) | View (Own) | Create | - |
| **Vouchers** | Manage Categories | - | Manage Own Stock | Redeem | - | - |
| **AI Models** | Manage/Deploy | View Version | - | - | Download | Upload |
| **Logs** | Full Audit | System Logs | - | - | Upload Logs | Upload Logs |

## 5. Implementasi di Laravel 12

*   **Middleware:** `auth:sanctum` untuk API, `role:slug` untuk pembatasan akses controller.
*   **Policies:** Menggunakan Laravel Policies untuk logika otorisasi granular (contoh: `UserPolicy`, `RvmPolicy`).
*   **Database Seeder:** `RolePermissionSeeder` harus dijalankan saat deployment awal untuk mengisi tabel `roles` dan `permissions` sesuai matriks di atas.

```