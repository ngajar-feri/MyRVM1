Peran **Teknisi** memang berbeda dari Admin karena mereka memerlukan akses fisik dan operasional langsung ke mesin, sementara Admin lebih bersifat manajerial/monitoring jarak jauh.

Berikut adalah revisi dokumen teknis dengan penambahan peran Teknisi dan alur kerja PIN akses RVM.

---

**Nama File:** [`user-role-mapping-Kamis-08012026-2255.md`](user-role-mapping-Kamis-08012026-2255.md)

```markdown
# Dokumentasi Teknis: Mapping Kredensial, Role, & Arsitektur Sistem (MyRVM v1.0)

**Versi Dokumen:** 1.2 [(Revisi dari 1.1)](user-role-mapping-Kamis-08012026-2240.md)
**Tanggal Revisi:** Kamis, 08 Januari 2026 - 10:55 PM
**Tujuan:** Mendefinisikan ulang hak akses pengguna (human) dan sistem (machine) serta alur kerja distribusi model AI dan manajemen sensor sesuai dengan arsitektur MyRVM v1.0, termasuk penambahan peran Teknisi Lapangan.

## 1. Definisi Aktor & Hierarki Peran

Sistem menggunakan pendekatan *Role-Based Access Control* (RBAC) yang hierarkis untuk pengguna manusia.

### A. Human Roles (Tabel `roles` & `users`)

| Role | Kode Slug | Pewarisan | Deskripsi & Kapabilitas |
| :--- | :--- | :--- | :--- |
| **Super Admin** | `super-admin` | - | **God Mode.** Akses penuh ke seluruh konfigurasi sistem, manajemen API Key mesin, manajemen Tenant global, dan akses ke "AI Playground" (RVM-CV). Dapat menugaskan Teknisi ke RVM tertentu. |
| **Admin** | `admin` | - | **Managerial Support.** Mengelola User, memantau dashboard status RVM-Edge secara global/regional, membuat tiket support, dan menugaskan tiket tersebut ke Teknisi. |
| **Teknisi** | `technician` | - | **Field Ops.** Menerima tugas (tiket) perbaikan. Memiliki akses untuk melihat detail teknis RVM yang ditugaskan dan mendapatkan **PIN Akses Sementara** untuk login ke Maintenance Mode di mesin fisik. |
| **Tenant** | `tenant` | `user` | **Mitra Bisnis.** Memiliki semua kemampuan **User**, ditambah akses ke Dashboard Tenant untuk membuat/mengelola Voucher dan validasi penukaran poin user. |
| **User** | `user` | - | **Pengguna Akhir.** Login, scan QR di RVM untuk mulai sesi, deposit botol, cek saldo (Poin/Gold), dan tukar poin dengan Voucher. |

### B. System Roles (Machine Identity)

| Aktor Mesin | Autentikasi | Deskripsi Fungsi |
| :--- | :--- | :--- |
| **RVM-Edge** | API Key (Header) | Unit fisik RVM. Memiliki hak untuk memulai sesi transaksi, mengirim telemetri sensor, sinkronisasi model AI, dan memvalidasi PIN Teknisi. |
| **RVM-CV** | Bearer Token | Node komputasi GPU. Memiliki hak untuk membaca dataset gambar (fraud/training) dan mengunggah model `best.pt` baru. |

## 2. Alur Kerja & Interaksi Sistem

### 2.1. Manajemen Akses Teknisi (PIN Dinamis)

Keamanan akses fisik ke mesin RVM sangat penting. Teknisi tidak memiliki akses permanen ke semua mesin, melainkan berbasis penugasan (Assignment).

1.  **Penugasan:** Admin/Super Admin mendeteksi masalah pada RVM-001. Mereka membuat tiket maintenance dan menugaskannya ke Teknisi A.
2.  **Generasi PIN:** RVM-Server secara otomatis men-generate **PIN Akses Sementara** (misal: 6 digit, valid selama 24 jam atau sampai tiket ditutup) khusus untuk RVM-001.
3.  **Distribusi:** Teknisi A melihat tugas di aplikasi mobile/dashboard-nya, yang mencakup lokasi mesin dan PIN Akses tersebut.
4.  **Eksekusi di Lapangan:**
    *   Teknisi A datang ke RVM-001.
    *   Pada layar sentuh, masuk ke menu "Maintenance".
    *   Input PIN Akses.
    *   RVM-Edge memvalidasi PIN ke Server (atau offline cache jika sinkronisasi terakhir sukses).
5.  **Akses Terbuka:** Jika valid, Teknisi A masuk ke *Maintenance Mode* untuk melakukan kalibrasi, tes motor, update model AI, dll.

### 2.2. Dinamika Sensor RVM-Edge (Flexible Payload)
API RVM-Server harus menerima data sensor secara dinamis (JSON) untuk mengakomodasi penambahan sensor di masa depan tanpa mengubah struktur database secara masif (menggunakan kolom tipe JSONB di PostgreSQL).

*   **Endpoint:** `POST /api/v1/edge/telemetry`
*   **Payload Contoh:**
    ```json
    {
      "device_id": "rvm-jakarta-001",
      "timestamp": "2026-01-08T22:30:00Z",
      "sensors": {
        "ultrasonic_level": 85,          // % kepenuhan bin
        "temperature_internal": 42.5,    // Derajat celcius
        "door_status": "locked",
        "new_sensor_xyz": 123            // Sensor baru bisa langsung ditambahkan
      }
    }
    ```

### 2.3. Manajemen Model AI (Training & Distribusi)

**A. RVM-CV (The Trainer - Stateless)**
1.  **Trigger:** Admin mengupload gambar baru ke "AI Playground" di Server atau memulai jadwal training.
2.  **Process:** RVM-CV mengunduh dataset dan model lama dari Server.
3.  **Execution:** Melakukan Training atau Testing (Inferensi).
4.  **Result:** Mengirim hasil (JSON/Image Result) atau Model Baru (`best.pt`) ke Server.
5.  **Cleanup:** Menghapus seluruh data lokal setelah task selesai.

**B. RVM-Server (The Hub)**
1.  **Storage:** Menyimpan versi-versi `best.pt` di MinIO/S3.
2.  **Versioning:** Mencatat hash (MD5/SHA256) dari setiap model untuk pengecekan update.
3.  **Playground UI:** Menyediakan antarmuka bagi Admin untuk memilih metode pengujian (menggunakan *Current Best Model* atau *Experimental Model* di RVM-CV).

**C. RVM-Edge (The Executor - Semi-Persistent)**
1.  **Routine Check:** Cronjob lokal berjalan (misal: tiap jam 00:00) membandingkan hash model lokal dengan API Server.
2.  **Update:** Jika hash berbeda, RVM-Edge mengunduh `best.pt` baru dari Server (atau GitHub Release sebagai fallback).
3.  **Manual Trigger:** Teknisi dapat menekan tombol "Update AI Model" pada menu *Maintenance Mode* di layar sentuh RVM.

### 2.4. User Interface RVM-Edge (Touchscreen)

Layar RVM memiliki dua mode tampilan:

1.  **Public Mode (Default):**
    *   Menampilkan QR Code Sesi (Dinamis).
    *   Instruksi cara pakai.
    *   Saat sesi aktif: Menampilkan Nama User, Jumlah Botol, Total Poin.
2.  **Maintenance Mode (Secured - Technician Only):**
    *   Diakses via Input PIN.
    *   Fitur: Kalibrasi Sensor, Test Motor/Conveyor, Cek Koneksi, **Update AI Model**, Lihat Log Lokal, Reboot System.

## 3. Implementasi Keamanan & Token

*   **Stable Coin Foundation:** Struktur database `wallets` harus siap mendukung pencatatan saldo desimal presisi tinggi (untuk konversi gramasi Emas/Crypto) selain poin integer biasa.
*   **API Security:** Komunikasi antara RVM-Edge dan Server wajib menggunakan HTTPS (SSL Pinned jika memungkinkan) untuk mencegah manipulasi data sensor atau poin.
*   **Audit Trail:** Setiap login teknisi dan aksi maintenance yang dilakukan di mesin dicatat dan dikirim ke server sebagai log audit.

```

Penambahan peran Teknisi dan mekanisme PIN ini sudah sesuai dengan kebutuhan operasional di lapangan.