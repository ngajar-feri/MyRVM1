# **Project Overview: MyRVM-Server (v2.1 Update)**
**Role:** Backend Core, Admin Dashboard, & Kiosk Interface Provider
**Parent Repository:** `MyRVM-Server`

## **1. Ringkasan & Tujuan**

`MyRVM-Server` adalah **otak pusat** dari ekosistem MyRVM. Ia tidak hanya berfungsi sebagai backend API yang mengelola data dan logika bisnis, tetapi juga bertanggung jawab menyajikan antarmuka pengguna berbasis web untuk berbagai peran: Administrator, Tenant, dan sekarang **Mesin RVM itu sendiri (via Kiosk Interface)**.

Evolusi ke v2.1 memperkenalkan arsitektur **"Server-Driven UI"** untuk mesin RVM, di mana tampilan layar sentuh pada mesin fisik dirender langsung oleh server menggunakan Blade & Vue.js, dan berkomunikasi secara *real-time* dengan kontroler fisik (Python Edge) melalui WebSocket.

## **2. Fungsi Utama**

1.  **Backend API (REST):**
    *   Melayani aplikasi mobile (`MyRVM-UserApp`, `MyRVM-TenantApp`).
    *   Melayani aplikasi edge (`MyRVM-Edge` Python Daemon) untuk handshake, telemetry, dan upload transaksi.
    *   Autentikasi terpusat dengan Laravel Sanctum.
2.  **Web Dashboards (RBAC):**
    *   **Super Admin:** Manajemen Tenant, Global Config, AI Playground.
    *   **Admin:** Manajemen User, RVM, Tiket Maintenance.
    *   **Tenant:** Manajemen Voucher, Laporan Penukaran.
3.  **RVM-UI (Kiosk Interface) - [FITUR BARU]:**
    *   Menyajikan antarmuka layar sentuh khusus untuk mesin RVM (`/rvm-ui/{uuid}`).
    *   Menampilkan QR Sesi Dinamis untuk pengguna.
    *   Menyediakan panel kontrol Maintenance untuk teknisi (dilindungi PIN).
    *   Berkomunikasi dua arah dengan Hardware via WebSocket.
4.  **Real-Time Communication Hub:**
    *   Menggunakan **Laravel Reverb** sebagai server WebSocket.
    *   Menjembatani event antara Frontend (Web/Mobile) dan Edge (Python).
5.  **Data & AI Management:**
    *   Menyimpan data transaksi, saldo user, dan telemetri sensor.
    *   Mengelola versi model AI (`best.pt`) dan mendistribusikannya.

## **3. Arsitektur Teknis**

### **Stack Teknologi**
*   **Framework:** Laravel 12 (PHP 8.2+).
*   **Database:** PostgreSQL 16+ (JSONB support).
*   **Frontend:** Blade Templates + Vue.js 3 (Composition API) + Tailwind CSS.
*   **Real-time:** Laravel Reverb + Laravel Echo.
*   **Storage:** MinIO (S3 Compatible).
*   **Infrastructure:** Docker Compose (App, Web, DB, MinIO, Reverb).

### **Struktur Modul RVM-UI (Kiosk)**
Modul ini diintegrasikan ke dalam struktur direktori yang ada:

*   **Routes:** `routes/web.php` (Prefix: `/rvm-ui`)
*   **Controllers:** `app/Http/Controllers/RvmUi/` (Baru)
    *   `KioskController.php` (Menangani render halaman utama)
    *   `MaintenanceController.php` (Menangani aksi teknisi)
*   **Views:** `resources/views/rvm-ui/` (Baru)
    *   `layout.blade.php` (Layout khusus tanpa navbar admin)
    *   `index.blade.php` (Container utama Vue)
*   **Assets (Vue):** `resources/js/rvm-ui/` (Baru)
    *   `app.js` (Entry point khusus Kiosk)
    *   `Components/` (IdleScreen, SessionScreen, MaintenancePanel)

## **4. Alur Kerja Kiosk (Server-Driven)**

1.  **Booting:** RVM-Edge (Python) meluncurkan browser ke `https://server/rvm-ui/{UUID}`.
2.  **Rendering:** Server memvalidasi UUID. Jika valid, merender halaman `index.blade.php` yang memuat aplikasi Vue Kiosk.
3.  **Koneksi:** Aplikasi Vue di browser terhubung ke WebSocket Channel `rvm.{UUID}`.
4.  **Interaksi:**
    *   **User Scan QR:** HP User -> API Server -> Event `SessionAuthorized` -> UI Kiosk berubah ke "Selamat Datang".
    *   **Teknisi Buka Pintu:** UI Kiosk (Tombol) -> API Server -> Event `Command:OpenDoor` -> Python Edge -> Motor Gerak.
    *   **Feedback:** Motor Selesai -> Python Edge -> API Server -> Event `DoorOpened` -> UI Kiosk (Animasi Pintu).

## **5. Perubahan Struktur Direktori (Refleksi)**

Berdasarkan struktur `MyRVM-Server` yang Anda lampirkan, berikut adalah tempat komponen Kiosk akan berada:

```text
MyRVM-Server/
├── app/
│   ├── Http/
│   │   ├── Controllers/
│   │   │   ├── RvmUi/               <-- [NEW]
│   │   │   │   ├── KioskController.php
│   │   │   │   └── MaintenanceApi.php
│   ├── Events/
│   │   ├── Rvm/                     <-- [NEW]
│   │   │   ├── CommandDispatched.php
│   │   │   ├── SessionAuthorized.php
│   │   │   └── HardwareStatusUpdated.php
├── resources/
│   ├── js/
│   │   ├── rvm-ui/                  <-- [NEW] Vue App khusus Kiosk
│   │   │   ├── app.js
│   │   │   ├── components/
│   │   │   └── stores/ (Pinia/State)
│   ├── views/
│   │   ├── rvm-ui/                  <-- [NEW] Blade wrapper
│   │   │   ├── layout.blade.php
│   │   │   └── index.blade.php
├── routes/
│   ├── web.php                      <-- Tambah route /rvm-ui/{uuid}
│   ├── api.php                      <-- Tambah endpoints untuk aksi Kiosk
│   └── channels.php                 <-- Definisi channel rvm.{uuid}
```

---

Dengan gambaran ini, **MyRVM-Server** kini memiliki peran ganda yang jelas: sebagai penyedia API konvensional dan sebagai *host* antarmuka cerdas untuk perangkat Edge.