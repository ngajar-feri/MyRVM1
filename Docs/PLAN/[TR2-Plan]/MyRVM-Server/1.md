Ini adalah **Project Plan** khusus untuk pengembangan modul **RVM-UI (Kiosk Interface)**. Perlu diingat bahwa secara teknis, modul ini berada di dalam repositori `MyRVM-Server` (Laravel), namun karena fungsinya sangat spesifik untuk tampilan mesin, ia membutuhkan perencanaan terpisah.

---

# Draft Project Plan: MyRVM-Server (Module: RVM-UI Kiosk Interface)

**Version:** 1.3
**Parent Repository:** `MyRVM-Server`
**Target Environment:** Chromium Browser (Kiosk Mode) pada Jetson Orin Nano (Resolusi: 1024x600 atau 1920x1080 Touchscreen).
**Design Philosophy:** Bio-Digital Minimalism (Matte, High Contrast, Fluid Animations).
**Role:** Menyajikan antarmuka visual ke layar sentuh dan menjembatani interaksi User/Teknisi ke Backend.
---

## 1. Executive Summary

**RVM-UI Kiosk** adalah modul frontend yang disajikan oleh server (server-side rendering awal dengan Blade, dilanjutkan dengan client-side interactivity dengan Vue.js). Modul ini dirancang untuk dijalankan pada layar sentuh mesin RVM.Antarmuka berbasis web yang disajikan oleh `MyRVM-Server` untuk ditampilkan pada layar sentuh mesin RVM. Antarmuka ini bertindak sebagai titik interaksi utama bagi pengguna umum (untuk melihat status sesi) dan teknisi (untuk kontrol maintenance).

Berbeda dengan Dashboard Admin biasa, UI ini dirancang khusus untuk **interaksi sentuh (touch-first)**, tanpa elemen navigasi browser, dan sangat reaktif terhadap event WebSocket dari backend maupun perangkat keras.

Modul ini tidak berkomunikasi langsung dengan hardware mesin. Sebaliknya, ia bertindak sebagai klien yang mengirimkan instruksi ke `MyRVM-Server` via API. Server kemudian meneruskan instruksi tersebut ke `MyRVM-Edge` (Python) melalui WebSocket.

Memiliki fitur dukungan Adaptive Theme (Light/Dark Mode) yang dapat diatur secara manual atau otomatis mengikuti waktu lokal mesin RVM, serta panel maintenance yang lebih terisolasi untuk keamanan data operasional.

---

## 2. Technical Architecture

### **Stack Teknologi**
*   **Backend Serving:** Laravel 12 (Blade Templates).
*   **Interactivity:** Vue.js 3 (Options/Composition API).
*   **Styling:** Tailwind CSS (Custom Config untuk Kiosk/Dark/Light Mode).
*   **Real-time:** Laravel Echo + Reverb (WebSocket).
*   **State Management:** Pinia (untuk mengelola Theme State & Machine Config).

### **Data Flow Architecture**
1.  **Request (Kiosk UI):** User/Teknisi menyentuh tombol di layar. Vue.js memanggil API Server (misal: `/api/v1/kiosk/command`).
2.  **Process (Server):** Laravel memvalidasi request dan otorisasi sesi kiosk.
3.  **Broadcast (Server):** Laravel memancarkan event WebSocket (misal: `HardwareCommandEvent`).
4.  **Execute (Edge):** Python Daemon di mesin menerima event dan mengeksekusi perintah hardware.
5.  **Feedback (Edge -> Server -> UI):** Python mengirim status terbaru ke API, Server mem-broadcast update ke UI Kiosk.

### **Communication Flow (The Triangle)**
UI ini tidak mengontrol hardware secara langsung. Ia berkomunikasi via Server.
1.  **UI -> Server (Action):** UI mengirim request HTTP ke Server (misal: "Teknisi menekan tombol Buka Pintu").
2.  **Server -> Edge (Command):** Server memvalidasi request, lalu mem-broadcast Event WebSocket `MaintenanceCommand`. Aplikasi Python di Edge menangkap event ini dan menggerakkan motor.
3.  **Edge -> Server -> UI (Feedback):** Sensor mendeteksi pintu terbuka -> Python lapor ke Server -> Server broadcast event `DoorStatusUpdated` -> UI menampilkan animasi pintu terbuka.

---

## 3. URL & API Endpoints Specification

Bagian ini memetakan rute yang harus ada di dalam `routes/web.php` dan `routes/api.php` pada `MyRVM-Server`.

### **A. Web Routes (Browser Entry Point)**
Ini adalah URL yang dituju oleh browser Chromium pada mesin RVM saat startup.

*   **URL:** `GET /rvm-ui/{machine_uuid}`
*   **Controller:** `App\Http\Controllers\Dashboard\KioskController@index`
*   **Fungsi:**
    *   Memvalidasi apakah `machine_uuid` terdaftar dan aktif.
    *   Merender view Blade dasar (`resources/views/dashboard/kiosk/index.blade.php`).
    *   Menginisialisasi aplikasi Vue.js.

### **B. API Endpoints (Consumed by Kiosk Vue App)**
Endpoint ini digunakan oleh komponen Vue di dalam Kiosk untuk logika bisnis. Semua request harus menyertakan header autentikasi (bisa berupa Token Sesi Mesin atau validasi IP/Middleware khusus).

**Group Prefix:** `/api/v1/kiosk`

| Method | Endpoint | Controller | Deskripsi Fungsi |
| :--- | :--- | :--- | :--- |
| **GET** | `/session/token` | `Kiosk\SessionController@getToken` | Meminta token sesi transaksi baru untuk ditampilkan sebagai QR Code. |
| **POST** | `/session/guest` | `Kiosk\SessionController@activateGuest` | Mengaktifkan mode tamu (donasi) tanpa scan QR user. |
| **POST** | `/auth/pin` | `Kiosk\AuthController@verifyPin` | Memvalidasi PIN Teknisi untuk masuk ke Maintenance Mode. |
| **POST** | `/maintenance/command` | `Kiosk\MaintenanceController@sendCommand` | Mengirim perintah hardware (Buka Pintu, Test Motor, Reboot). Payload: `{ "command": "test_motor", "params": {...} }`. |
| **GET** | `/logs` | `Kiosk\LogController@index` | Mengambil 20 log aktivitas terakhir mesin untuk ditampilkan ke teknisi. |
| **POST** | `/config/theme` | `ConfigController@updateTheme` | Menyimpan preferensi tema (Auto/Manual) untuk mesin ini. |


---

## 4. UI/UX Design Specifications (Bio-Digital)
### **4.1. Theme & Visual System (Adaptive)**

Sistem UI mendukung mode **Light** dan **Dark** yang dapat berubah otomatis berdasarkan waktu lokal mesin (jam dari Jetson Orin Nano).

#### **A. Palet Warna Light Mode (Natural & Organic)**
| Nama Warna (ID) | Kode Hex | Deskripsi & Tujuan Filosofis |
| :--- | :--- | :--- |
| **Latar Belakang Utama** | `#FDFDFD` | **Putih Alami.** Sedikit lebih lembut dari putih murni untuk mengurangi silau layar dan memberikan kesan kertas alami. |
| **Latar Belakang Sekunder** | `#EEEEEE` | **Abu-abu Sangat Terang.** Ideal untuk navigasi samping atau kontainer konten yang lembut, memberikan kedalaman tanpa mengganggu fokus. |
| **Teks Utama** | `#404040` | **Abu-abu Arang Hangat.** Kontras yang sangat baik dan nyaman dibaca, terasa lebih organik daripada hitam pekat. |
| **Teks Sekunder** | `#9E9E9E` | **Abu-abu Sedang Netral.** Untuk informasi tambahan, tanggal, atau ikon yang tidak memerlukan penekanan kuat. |
| **Aksen Utama** | `#4CAF50` | **Hijau Alam (Nature Green).** Diasosiasikan dengan kesehatan, pertumbuhan, dan keseimbangan. Aksen yang menenangkan dan positif. |
| **Aksen Peringatan** | `#FFB74D` | **Oranye Lembut.** Notifikasi atau status peringatan yang menarik perhatian secara lembut, tidak mengancam. |

#### **B. Palet Warna Dark Mode (Low Light & Energy Saving)**
*   **Latar Belakang:** `#1A1A1A` (Deep Charcoal) - Mengurangi emisi cahaya biru di malam hari.
*   **Teks Utama:** `#E0E0E0` (Soft White).
*   **Aksen:** Tetap menggunakan Hijau Alam namun dengan *luminance* yang disesuaikan agar tetap terlihat jelas di latar gelap.

### **4.2. Visual Language**
*   **Typography:** Ukuran font besar (min 24px), Sans-serif (Inter/Roboto), High readability.
*   **Feedback:** Setiap sentuhan memiliki efek visual (ripple/scale) instan.
*   **Animasi:** Biomimikri. Contoh: *Loading* bukan spinner berputar, tapi gelombang air atau daun yang terisi.

### **4.3. State Management (Screen States)**
UI hanya memiliki satu URL utama (`/rvm-ui/{uuid}`), konten berubah dinamis berdasarkan State Vue.js:

1.  **IDLE:** Menampilkan QR Code Sesi (besar) & Tombol "Mode Tamu".
2.  **ACTIVE_USER:** Menampilkan "Halo, [Nama]", Saldo saat ini, & Instruksi.
3.  **PROCESSING:** Animasi saat botol sedang dianalisis AI.
4.  **RESULT:** Pop-up hasil (Diterima +Poin / Ditolak).
5.  **MAINTENANCE_LOGIN:** Keypad Angka untuk input PIN.
6.  **MAINTENANCE_DASHBOARD:** Panel kontrol teknisi.

### **4.4. Configuration Feature (Setup Wizard Integration)**
Pada tahap instalasi awal (Setup Wizard di RVM-Edge), ditambahkan langkah konfigurasi waktu:
*   **Time Zone Configuration:**
    *   **Manual:** Dropdown untuk memilih zona waktu (misal: `Asia/Jakarta`).
    *   **Automatic:** Sinkronisasi via NTP (Internet Time) saat terkoneksi.
*   Data zona waktu ini dikirim ke server saat **Handshake** dan disimpan di database `edge_devices`.
*   UI Kiosk menggunakan data ini untuk menentukan kapan harus beralih mode (misal: Auto Dark Mode pukul 18:00 - 06:00 waktu lokal mesin).

### **4.5. Public Interface (Default State)**
*   **Komponen:** `IdleScreen.vue`, `SessionScreen.vue`.
*   **Fitur:** QR Code Dinamis, WebSocket Listener, Visual Feedback Animasi.

### **4.6. Maintenance Interface (Technician Flow)**
*   **Access Trigger:** Tombol tersembunyi / Gesture.
*   **Pin Pad:** Virtual NumPad untuk login.
*   **Control Panel:**
    *   **Theme Toggle:** Switch manual (Light/Dark/Auto).
    *   **Log Viewer (Revisi):**
        *   Jendela scrollable menampilkan 20 log terakhir.
        *   **Filtering:** Backend **wajib** memfilter query log `WHERE rvm_machine_id = {current_machine_id}`.
        *   Teknisi di Mesin A **tidak boleh** melihat log error dari Mesin B atau aktivitas modul User lain. Ini memastikan privasi dan relevansi data saat debugging di lapangan.

---

## 5. Feature Specifications

### **5.1. Public Interface (User Flow)**

*   **Dynamic QR Display:**
    *   Mengambil token sesi dari API `session/create`.
    *   Generate QR Code menggunakan library JS (`qrcode.vue` atau sejenis).
    *   *Auto-refresh* QR setiap 5 menit (keamanan).
*   **Guest Mode Trigger:**
    *   Tombol fisik-virtual "Mulai Donasi".
    *   Memanggil API `session/activate-guest`.
*   **Live Transaction Feed:**
    *   Mendengarkan event `ItemProcessed`.
    *   Menampilkan *running list* item yang dimasukkan (misal: "1x Botol PET (+Rp 50)").
    *   Menampilkan total saldo sesi berjalan.

### **5.2. Maintenance Interface (Technician Flow)**

*   **Access Trigger:** Tombol tersembunyi (misal: Tap logo 5x)
*   **PIN Pad:**
    *   Virtual NumPad muncul di layar (karena tidak ada keyboard fisik).
    *   Mengirim PIN + Device ID ke endpoint validasi.
*   **Control Panel:**
    *   **Health Status:** Indikator status koneksi (Server, Python Daemon, Sensor).
    *   **Hardware Controls:** Tombol Toggle/Push:
        *   [Buka/Tutup Pintu]
        *   [Start/Stop Conveyor]
        *   [Test LED]
    *   **AI Management:** Tombol `[Check Model Update]`.
    *   **Log Viewer:** Jendela scrollable menampilkan 20 log terakhir dari server.

---

## 5. API Integration Requirements (Backend Laravel)

Untuk mendukung UI ini, `MyRVM-Server` perlu menyediakan rute & endpoint khusus:

### **Routes (Web)**
*   `GET /rvm-ui/{uuid}`: Halaman utama Kiosk. Membutuhkan validasi UUID mesin yang valid.

### **Routes (API - Consumed by Vue.js)**
*   `GET /api/v2/kiosk/session/token`: Request token sesi baru.
*   `POST /api/v2/kiosk/auth/pin`: Validasi PIN Teknisi.
*   `POST /api/v2/kiosk/maintenance/command`: Kirim perintah hardware (akan di-relay ke WebSocket).
    *   Payload: `{ "command": "test_motor", "params": {...} }`

---

## 6. Implementation Roadmap

### **Phase 1: Backend Routes & Controller Setup**
*   Membuat Controller `KioskController` dan `Api\Kiosk\*`.
*   Mendaftarkan rute di `web.php` dan `api.php`.
*   Membuat Event Classes untuk Broadcasting.
*   Implementasi logika filtering log berdasarkan `machine_uuid` di `LogController`.

### **Phase 2: Frontend Foundation**
*   Membuat layout Blade bersih (tanpa header/footer admin, margin).
*   Setup konfigurasi Vite untuk mengompilasi entry point `resources/js/kiosk/app.js` secara terpisah dari `app.js` utama (agar file lebih ringan).
*   Implementasi desain dasar (Idle Screen) dengan QR Code statis.
*   Membuat css untuk Styling khusus (Dark mode, Light mode, Large fonts)
*   Konfigurasi Tailwind `tailwind.config.js` dengan palet warna kustom (Light & Dark).
*   Implementasi `themeStore` di Pinia untuk menangani logika perpindahan tema otomatis berdasarkan jam.

### **Phase 3: Real-time Integration**
*   Setup Laravel Echo.
*   Test koneksi WebSocket: Mengubah tampilan layar dari Server (Debug tool).
*   Implementasi perubahan State UI berdasarkan Event (`SesiDiotorisasi`, `ItemDiterima`).

### **Phase 4: Component Development and Maintenance Module**
*   Membuat komponen Vue `PinPad.vue` (Logic validasi ke API).
*   Membuat komponen Vue `ControlPanel.vue`.
*   Develop `IdleScreen` (QR Display).
*   Develop `MaintenancePanel` (Tombol aksi).
*   Integrasi API Command ke Server.
*   Develop `MaintenancePanel` dengan fitur Toggle Theme dan Log Viewer yang sudah terisolasi datanya.

### **Phase 5: Polish & UX**
*   Implementasi animasi transisi antar state.
*   Handling kondisi *Offline* (Menampilkan layar "Maaf, Sedang Gangguan" jika WebSocket putus).
*   Testing responsivitas sentuhan.

### **Phase 6: Integration Testing**
*   Integrasi data zona waktu dari database ke frontend Vue.
*   Simulasi alur: Klik tombol di Vue -> API -> Event -> (Mockup Python) -> Event -> Vue Update.
---

## 7. Directory Structure (Inside MyRVM-Server)

Berikut adalah lokasi file yang harus dibuat/dipastikan ada dalam struktur folder `MyRVM-Server`:

```text
MyRVM-Server/
├── app/
│   ├── Http/
│   │   ├── Controllers/
│   │   │   ├── Dashboard/
│   │   │   │   └── KioskController.php      # Render Halaman kiosk-ui & Inject Config
│   │   │   ├── Api/
│   │   │   │   └── Kiosk/                   # API Khusus Kiosk
        │   │       ├── LogController.php    # Log Viewer (Scoped by Machine ID)
        │   │       ├── ConfigController.php # Theme Config
│   │   │   │       ├── SessionController.php
│   │   │   │       ├── AuthController.php
│   │   │   │       └── MaintenanceController.php
│   ├── Events/
│   │   └── Kiosk/
│   │       ├── HardwareCommandEvent.php     # Event ke Python
│   │       └── UiUpdateEvent.php            # Event ke Vue
├── resources/
│   ├── css/
│   │   └── kiosk.css   # Styling khusus - Tailwind Custom Config (Dark mode, Light mode, Large fonts, Colors)
│   ├── js/
│   │   ├── kiosk/                   # Vue App Khusus Kiosk
│   │   │   ├── app.js               # Entry Point
│   │   │   ├── router/              # Vue Router (jika perlu)
│   │   │   ├── stores/
│   │   │       └── themeStore.js    # Pinia State: Manage Light/Dark Logic
│   │   │   └── components/
│   │   │       ├── IdleScreen.vue
│   │   │       ├── ActiveSession.vue
│   │   │       ├── PinPad.vue
│   │   │       ├── LogViewer.vue  # Component Log Viewer
│   │   │       └── MaintenancePanel.vue
│   ├── views/
│   │   └── dashboard/
│   │       └── kiosk/
│   │           ├── layout.blade.php         # HTML Skeleton (No Navbar)
│   │           └── index.blade.php          # Vue Mount Point
├── routes/
│   ├── web.php                              # Route: /rvm-ui/{uuid}
│   ├── api.php                              # Routes Group: /api/v1/kiosk/*
│   └── channels.php                         # Broadcast Channel: rvm.{uuid}
```

---

Apakah rencana untuk modul **RVM-UI** ini sudah sesuai dengan ekspektasi Anda? Jika ya, ini bisa menjadi panduan saat kita mengerjakan bagian Frontend nanti.